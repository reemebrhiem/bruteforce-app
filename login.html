<!DOCTYPE html>
<html>
<head>
    <title>تسجيل الدخول</title>
    <style>
        body { display:flex; justify-content:center; align-items:center; height:100vh; font-family:Arial }
        .box { width:300px; text-align:center }
        input, button { width:100%; margin:5px 0; padding:8px }
        button { cursor:pointer }
    </style>
</head>
<body>
<div class="box">
    <h2>تسجيل الدخول</h2>

    <input id="username" placeholder="اسم المستخدم">
    <input id="password" type="password" placeholder="كلمة المرور">
    <button onclick="login()">دخول</button>
    <button onclick="location.href='/register'">إنشاء حساب</button>

    <p id="msg" style="color:red"></p>
    <p id="timer" style="color:blue"></p>
</div>

<script>
let blocked = false;

function startTimer(seconds){
    const timer = document.getElementById("timer");
    let s = seconds;

    timer.innerText = "يمكنك المحاولة بعد " + s + " ثانية";

    const i = setInterval(() => {
        s--;
        timer.innerText = "يمكنك المحاولة بعد " + s + " ثانية";
        if(s <= 0){
            clearInterval(i);
            timer.innerText = "";
        }
    }, 1000);
}

function login(){
    if(blocked) return;

    const msg = document.getElementById("msg");
    msg.innerText = "";

    fetch("/login", {
        method:"POST",
        headers:{ "Content-Type":"application/x-www-form-urlencoded" },
        body:`username=${username.value}&password=${password.value}`
    })
    .then(r => r.json())
    .then(data => {
        if(data.status === "success"){
            window.location.href = "/dashboard/" + username.value;
        }
        else if(data.status === "blocked"){
            msg.innerText = data.message;
            blocked = true;
            document.querySelectorAll("button").forEach(b => b.disabled = true);
            startTimer(60);
            setTimeout(() => {
                blocked = false;
                document.querySelectorAll("button").forEach(b => b.disabled = false);
                msg.innerText = "";
            }, 60000);
        }
        else{
            msg.innerText = data.message;
        }
    });
}
</script>
</body>
</html>