<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>

<style>
body {
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Arial;
    background:#f5f5f5;
}
.box {
    width:320px;
    background:white;
    padding:20px;
    border-radius:8px;
    text-align:center;
}
input, button {
    width:100%;
    padding:10px;
    margin:6px 0;
}
#msg { color:red; }
</style>
</head>

<body>
<div class="box">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>

<form onsubmit="login(); return false;">
    <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button type="submit">Ø¯Ø®ÙˆÙ„</button>
</form>

<button onclick="location.href='/register'">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
<div id="msg"></div>
</div>

<script>
let blocked = false;
let timerInterval;

function startTimer(seconds){
    const msg = document.getElementById("msg");
    const loginBtn = document.querySelector("button[type='submit']");
    const regBtn = document.querySelector("button:not([type='submit'])");

    blocked = true;
    loginBtn.disabled = true;
    regBtn.disabled = true;

    let s = seconds;
    msg.innerText = "ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù‡Ø¬ÙˆÙ… Ù‚ÙˆØ© ØºØ§Ø´Ù…Ø© ğŸš¨ Ø­Ø§ÙˆÙ„ Ø¨Ø¹Ø¯ " + s + " Ø«Ø§Ù†ÙŠØ©";

    timerInterval = setInterval(() => {
        s--;
        msg.innerText = "ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù‡Ø¬ÙˆÙ… Ù‚ÙˆØ© ØºØ§Ø´Ù…Ø© ğŸš¨ Ø­Ø§ÙˆÙ„ Ø¨Ø¹Ø¯ " + s + " Ø«Ø§Ù†ÙŠØ©";

        if(s <= 0){
            clearInterval(timerInterval);
            blocked = false;
            loginBtn.disabled = false;
            regBtn.disabled = false;
            msg.innerText = "";
        }
    },1000);
}

function login(){
    if(blocked) return;

    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const msg = document.getElementById("msg");

    fetch("/login",{
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body:"username="+username+"&password="+password
    })
    .then(res => res.text().then(t => ({status:res.status, text:t})))
    .then(r => {
        if(r.status === 200){
            location.href="/dashboard/"+username;
        }
        else if(r.text.startsWith("BLOCKED")){
            const seconds = parseInt(r.text.split(":")[1]);
            startTimer(seconds);
        }
        else if(r.text === "NO_USER"){
            msg.innerText="Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
        }
        else if(r.text === "WRONG_PASSWORD"){
            msg.innerText="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
        }
    });
}
</script>
</body>
</html>

